@startuml

entity "users" as users {
    id: INT <<PK>>
    username: VARCHAR(255)
    staffId: VARCHAR(255)
    is_anonymous: BOOLEAN
    public_key: VARCHAR(255)
    email: VARCHAR(255)
    last_modified: TIMESTAMP
    created_at: TIMESTAMP
}

entity "surveys" as surveys {
    id: INT <<PK>>
    title: VARCHAR(255)
    description: TEXT
    user_id: INT <<FK>>
    allow_anonymous_reply: BOOLEAN
    allow_resubmit: BOOLEAN
    is_deleted: BOOLEAN
    start_time: TIMESTAMP
    end_time: TIMESTAMP
    max_replies: INT
    last_modified: TIMESTAMP
    created_at: TIMESTAMP
}

entity "templates" as templates {
    id: INT <<PK>>
    title: VARCHAR(255)
    description: TEXT
    user_id: INT <<FK>>
    is_deleted: BOOLEAN
    last_modified: TIMESTAMP
    created_at: TIMESTAMP
}

entity "questions" as questions {
    id: INT <<PK>>
    survey_id: INT <<FK>>
    seq: INT
    question_text: TEXT
    question_type: ENUM
}

entity "options" as options {
    id: INT <<PK>>
    question_id: INT <<FK>>
    seq: INT
    option_text: VARCHAR(255)
}

entity "survey_reply" as survey_reply {
    id: INT <<PK>>
    user_id: INT <<FK>>
    survey_id: INT <<FK>>
    last_modified: TIMESTAMP
    created_at: TIMESTAMP
}

entity "question_reply" as question_reply {
    id: INT <<PK>>
    survey_reply_id: INT <<FK>>
    question_id: INT <<FK>>
    reply_text: TEXT
}

entity "option_reply" as option_reply {
    id: INT <<PK>>
    question_reply_id: INT <<FK>>
    option_id: INT <<FK>>
    selected: BOOLEAN
}

entity "prizes" as prizes {
    id: INT <<PK>>
    survey_id: INT <<FK>>
    prize_name: VARCHAR(255)
    prize_description: TEXT
    total_quantity: INT
    remaining_quantity: INT
    last_modified: TIMESTAMP
    created_at: TIMESTAMP
}

entity "winners" as winners {
    id: INT <<PK>>
    user_id: INT <<FK>>
    survey_id: INT <<FK>>
    prize_id: INT <<FK>>
    won_at: TIMESTAMP
}

entity "delegate" as delegate {
    id: INT <<PK>>
    delegator_id: INT <<FK>>
    delegate_id: INT <<FK>>
}

users -- surveys : user_id
users -- templates : user_id
users -- survey_reply : user_id
users -- winners : user_id
users -- delegate : delegator_id
users -- delegate : delegate_id
surveys -- questions : survey_id
templates -- questions : template_id
questions -- options : question_id
survey_reply -- question_reply : survey_reply_id
question_reply -- option_reply : question_reply_id
options -- option_reply : option_id
surveys -- prizes : survey_id
prizes -- winners : prize_id
surveys -- winners : survey_id

@enduml
